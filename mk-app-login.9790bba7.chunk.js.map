{"version":3,"sources":["webpack:///./apps/login/component.js","webpack:///./apps/login/action.js","webpack:///./apps/login/reducer.js"],"names":["C","props","monkeyKing","path","creator","action","option","onInit","component","injections","reduce","getLogo","config","logo","login","form","metaAction","gf","toJS","check","value","mobile","password","ok","webapi","user","response","context","set","onRedirect","goAfterLogin","goRegister","apps","goForgot","fieldChange","fieldPath","fieldPathAndValues","checkResults","o","r","checkMobile","checkPassword","push","json","hasError","forEach","errorPath","message","sfs","test","current","ret","metaHandlers","reducer","init","state","metaReducer"],"mappings":"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","file":"mk-app-login.9790bba7.chunk.js","sourcesContent":["import React, { Component } from 'react'\r\n\r\nimport { wrapper } from 'mk-meta-engine'\r\n\r\nimport appInfo from './index'\r\n\r\n@wrapper(appInfo)\r\nexport default class C extends Component {\r\n\trender() {\r\n\t\treturn this.props.monkeyKing({ ...this.props, path: 'root' })\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/login/component.js","import React from 'react'\r\nimport { action as MetaAction, AppLoader } from 'mk-meta-engine'\r\nimport config from './config'\r\n\r\nclass action {\r\n    constructor(option) {\r\n        this.metaAction = option.metaAction\r\n        this.config = config.current\r\n        this.webapi = this.config.webapi\r\n    }\r\n\r\n    onInit = ({ component, injections }) => {\r\n        this.component = component\r\n        this.injections = injections\r\n        injections.reduce('init')\r\n    }\r\n\r\n    getLogo = () => this.config.logo\r\n\r\n    login = async () => {\r\n        const form = this.metaAction.gf('data.form').toJS()\r\n\r\n        const ok = await this.check([{\r\n            path: 'data.form.mobile', value: form.mobile\r\n        }, {\r\n            path: 'data.form.password', value: form.password\r\n        }])\r\n\r\n        if (!ok) return\r\n\r\n        const response = await this.webapi.user.login(form)\r\n        this.metaAction.context.set('currentUser', response)\r\n\r\n        if (this.component.props.onRedirect && this.config.goAfterLogin) {\r\n            this.component.props.onRedirect(this.config.goAfterLogin)\r\n        }\r\n    }\r\n\r\n    goRegister = () => {\r\n        if(!this.config.apps['mk-app-register']){\r\n            throw '请将这个应用加入到带mk-app-root和mk-app-register的网站中，跳转功能才能正常使用'\r\n        }\r\n        if (this.component.props.onRedirect && this.config.goRegister) {\r\n            this.component.props.onRedirect(this.config.goRegister)\r\n        }\r\n    }\r\n\r\n    goForgot = () =>{\r\n        if(!this.config.apps['mk-app-forgot-password']){\r\n            throw '请将这个应用加入到带mk-app-root和mk-app-forgot-password的网站中，跳转功能才能正常使用'\r\n        }\r\n        if (this.component.props.onRedirect && this.config.goForgot) {\r\n            this.component.props.onRedirect(this.config.goForgot)\r\n        }\r\n    }\r\n\r\n    fieldChange = async (fieldPath, value) => {\r\n        await this.check([{ path: fieldPath, value }])\r\n    }\r\n\r\n    check = async (fieldPathAndValues) => {\r\n        if (!fieldPathAndValues)\r\n            return\r\n\r\n        var checkResults = []\r\n\r\n        for (var o of fieldPathAndValues) {\r\n            let r = { ...o }\r\n            if (o.path == 'data.form.mobile') {\r\n                Object.assign(r, await this.checkMobile(o.value))\r\n            }\r\n            else if (o.path == 'data.form.password') {\r\n                Object.assign(r, await this.checkPassword(o.value))\r\n            }\r\n            checkResults.push(r)\r\n        }\r\n\r\n        var json = {}\r\n        var hasError = true\r\n        checkResults.forEach(o => {\r\n            json[o.path] = o.value\r\n            json[o.errorPath] = o.message\r\n            if (o.message)\r\n                hasError = false\r\n        })\r\n\r\n        this.metaAction.sfs(json)\r\n\r\n        return hasError\r\n    }\r\n\r\n\r\n    checkMobile = async (mobile) => {\r\n        var message\r\n\r\n        if (!mobile)\r\n            message = '请录入手机号'\r\n        else if (!/^1[3|4|5|8][0-9]\\d{8}$/.test(mobile))\r\n            message = '请录入有效的手机号'\r\n\r\n        return { errorPath: 'data.other.error.mobile', message }\r\n    }\r\n\r\n    checkPassword = async (password) => {\r\n        var message\r\n\r\n        if (!password)\r\n            message = '请录入密码'\r\n\r\n        return { errorPath: 'data.other.error.password', message }\r\n    }\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaAction = new MetaAction(option),\r\n        o = new action({ ...option, metaAction }),\r\n        ret = { ...metaAction, ...o }\r\n\r\n    metaAction.config({ metaHandlers: ret })\r\n\r\n    return ret\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/login/action.js","import { Map } from 'immutable'\r\nimport { reducer as MetaReducer } from 'mk-meta-engine'\r\nimport config from './config'\r\nimport { getInitState } from './data'\r\n\r\nclass reducer {\r\n    constructor(option) {\r\n        this.metaReducer = option.metaReducer\r\n    }\r\n\r\n    init = (state, option) => {\r\n        return this.metaReducer.init(state, getInitState())\r\n    }\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaReducer = new MetaReducer(option),\r\n        o = new reducer({ ...option, metaReducer })\r\n\r\n    return { ...metaReducer, ...o }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/login/reducer.js"],"sourceRoot":""}