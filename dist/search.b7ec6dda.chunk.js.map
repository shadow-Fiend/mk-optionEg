{"version":3,"sources":["webpack:///./apps/portal/search/component.js","webpack:///./apps/portal/search/action.js","webpack:///./apps/portal/search/reducer.js"],"names":["C","props","monkeyKing","path","creator","action","option","onInit","component","injections","reduce","pagination","metaAction","gf","toJS","load","ret","webapi","search","query","response","hits","length","toast","handleChange","key","e","target","value","handleSearch","match","content","highlight","pre_tags","post_tags","fields","pageChanged","current","pageSize","getLayout","size","map","o","index","getSingleLayout","get","id","i","x","y","Math","floor","w","h","config","metaHandlers","reducer","init","state","initState","metaReducer","_shards","allInfo","total","pagiSize","push","__html","sf","changeSearch"],"mappings":"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","file":"search.b7ec6dda.chunk.js","sourcesContent":["import React, { Component } from 'react'\r\nimport { wrapper } from 'mk-meta-engine'\r\nimport appInfo from './index'\r\n\r\n@wrapper(appInfo)\r\nexport default class C extends Component {\r\n\trender() {\r\n\t\treturn this.props.monkeyKing({ ...this.props, path: 'root' })\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/component.js","import React from 'react'\r\nimport { action as MetaAction, AppLoader } from 'mk-meta-engine'\r\nimport config from './config'\r\n\r\nclass action {\r\n    constructor(option) {\r\n        this.metaAction = option.metaAction\r\n        this.config = config.current\r\n        this.webapi = this.config.webapi\r\n    }\r\n\r\n    onInit = ({ component, injections }) => {\r\n        this.component = component\r\n        this.injections = injections\r\n        injections.reduce('init')\r\n        const pagination = this.metaAction.gf('data.pagination').toJS()\r\n//        this.load(pagination)\r\n    }\r\n\r\n    load = async (ret) =>{\r\n        const response = await this.webapi.search.query(ret)\r\n        if(!response.hits.hits.length) {\r\n            this.metaAction.toast('error', '暂无结果')\r\n            return\r\n        }\r\n        this.injections.reduce('load', response)\r\n    }\r\n    \r\n    handleChange = (key) => (e) => {\r\n        if(key == 'searchKey') {\r\n            this.injections.reduce('changeSearch', key, e.target.value)\r\n        }\r\n    }\r\n    \r\n    handleSearch = (key) => (e) => {\r\n        if(!e) {\r\n            this.metaAction.toast('error', '请输入内容进行操作')\r\n            return \r\n        } \r\n        \r\n        if(key == 'searchKey') {\r\n            let pagination = this.metaAction.gf('data.pagination').toJS(),\r\n            ret = {\r\n                query: {match: {\r\n                    content: e\r\n                }},\r\n                highlight: {\r\n                    pre_tags: ['<b>'],\r\n                    post_tags: ['</b>'],\r\n                    fields: {\r\n                        content: {}\r\n                    }\r\n                }\r\n            }\r\n            this.load(ret)\r\n        }\r\n    }\r\n\r\n    pageChanged = (current, pageSize) => {\r\n//        this.load({ current, pageSize })\r\n    }\r\n\r\n    getLayout = () => {\r\n        const hits = this.metaAction.gf('data.hits')\r\n        if(!hits || hits.size == 0) return\r\n                \r\n        return hits.map((o, index)=>this.getSingleLayout(index, o.get('id'))).toJS()\r\n    }\r\n\r\n    getSingleLayout = (index, id) =>{\r\n        return {\r\n            i: id + '',\r\n            x: (index % 4) * 3,\r\n            y: Math.floor(index / 4) * 4,\r\n            w: 3,\r\n            h: 4\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaAction = new MetaAction(option),\r\n        o = new action({ ...option, metaAction }),\r\n        ret = { ...metaAction, ...o }\r\n\r\n    metaAction.config({ metaHandlers: ret })\r\n\r\n    return ret\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/action.js","import { Map, fromJS } from 'immutable'\r\nimport { reducer as MetaReducer } from 'mk-meta-engine'\r\nimport config from './config'\r\nimport { getInitState } from './data'\r\n\r\nclass reducer {\r\n    constructor(option) {\r\n        this.metaReducer = option.metaReducer\r\n        this.config = config.current\r\n    }\r\n\r\n    init = (state, option) => {\r\n        const initState = getInitState()\r\n        return this.metaReducer.init(state, initState)\r\n    }\r\n\r\n    load = (state, {hits, _shards}) => {\r\n        let allInfo = [],\r\n            pagination = {\r\n                current: 1,\r\n                total: hits.hits.length,\r\n                pagiSize: 8\r\n            }\r\n        hits.hits.map(o => {\r\n            allInfo.push({\r\n                __html: o.highlight.content\r\n            })\r\n        })\r\n        \r\n        state = this.metaReducer.sf(state, 'data.hits', fromJS(hits.hits))\r\n        state = this.metaReducer.sf(state, 'data.allInfo', fromJS(allInfo))\r\n        state = this.metaReducer.sf(state, 'data.pagination', fromJS(pagination))\r\n        return state\r\n    }\r\n    \r\n    changeSearch = (state, key, value) => {\r\n        state = this.metaReducer.sf(state, 'data.' + key, value)\r\n        return state\r\n    }\r\n\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaReducer = new MetaReducer(option),\r\n        o = new reducer({ ...option, metaReducer })\r\n\r\n    return { ...metaReducer, ...o }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/reducer.js"],"sourceRoot":""}