{"version":3,"sources":["webpack:///./apps/portal/search/bussinessSearch/component.js","webpack:///./apps/portal/search/bussinessSearch/action.js","webpack:///./apps/portal/search/bussinessSearch/reducer.js"],"names":["C","props","monkeyKing","path","creator","action","option","onInit","component","injections","reduce","load","pagination","filter","webapi","search","query","response","handleFresh","type","handleRefresh","refresh","metaAction","toast","handleSearch","e","value","target","allManualKeys","gf","toJS","searchValue","searchBussiness","length","map","o","businessCode","item","push","editRow","args","pop","rowIndex","row","modal","title","children","loadApp","store","rowInfo","handleEditCb","ret","result","update","get","keys","data","getListRowsCount","size","pageChanged","current","pageSize","config","metaHandlers","reducer","init","state","initState","metaReducer","sf","list","searchKeys","set","clearEditKeys","setIn"],"mappings":"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","file":"bussinessSearch.b7ec6dda.chunk.js","sourcesContent":["import React, { Component } from 'react'\r\nimport { wrapper } from 'mk-meta-engine'\r\nimport appInfo from './index'\r\n\r\n@wrapper(appInfo)\r\nexport default class C extends Component {\r\n\trender() {\r\n\t\treturn this.props.monkeyKing({ ...this.props, path: 'root' })\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/bussinessSearch/component.js","import React from 'react'\r\nimport { action as MetaAction, AppLoader } from 'mk-meta-engine'\r\nimport config from './config'\r\n\r\nclass action {\r\n    constructor(option) {\r\n        this.metaAction = option.metaAction\r\n        this.config = config.current\r\n        this.webapi = this.config.webapi\r\n    }\r\n\r\n    onInit = ({ component, injections }) => {\r\n        this.component = component\r\n        this.injections = injections\r\n        injections.reduce('init')\r\n        this.load()\r\n    }\r\n    \r\n    load = async (pagination, filter ={}) => {\r\n        const response = await this.webapi.search.query()\r\n        response.filter = filter\r\n        this.injections.reduce('load', response)\r\n    }\r\n    \r\n    handleFresh = (type) => () => {\r\n        if(type == 'fresh') {\r\n            this.load()\r\n        }\r\n    }\r\n    \r\n    handleRefresh = async () => {\r\n        const response = await this.webapi.search.refresh({})\r\n        if(response) {\r\n            this.metaAction.toast('success', '关键字全部重新生成成功!')\r\n        } else {\r\n            this.metaAction.toast('error', '关键字全部重新生成失败!')\r\n        }\r\n    }\r\n    \r\n    handleSearch = (type) => async(e) => {\r\n        let {metaAction} = this, value\r\n        \r\n        if(e && e.target && e.target.value) {\r\n            value = e.target.value\r\n        }\r\n        \r\n        if(type == 'search') {\r\n            let allManualKeys = metaAction.gf('data.allManualKeys') ? metaAction.gf('data.allManualKeys').toJS() : [],\r\n                searchValue = []\r\n            \r\n            if(!value) {\r\n                searchValue = allManualKeys\r\n            } else {\r\n                const response = await this.webapi.search.searchBussiness(value)\r\n\r\n                if(response && response.length) {\r\n                    response.map(o => {\r\n                        allManualKeys.map(item => {\r\n                            if (o.businessCode == item.businessCode) {\r\n                                searchValue.push(item)\r\n                            }\r\n                        })\r\n                    })\r\n                }\r\n            }\r\n            this.injections.reduce('searchKeys', searchValue, type, value)\r\n        }\r\n    }\r\n    \r\n    editRow = async (...args) => {\r\n        const { rowIndex } = args.pop()\r\n        const row = this.metaAction.gf(`data.list.${rowIndex}`).toJS()\r\n        \r\n        const ret = await this.metaAction.modal('show', {\r\n            title: '',\r\n            children: this.metaAction.loadApp('busSearchSet', {\r\n                store: this.component.props.store,\r\n                rowInfo: row,\r\n                handleEditCb: this.handleEditCb(this.injections, rowIndex)\r\n            })\r\n        })\r\n        if(ret.result) {\r\n            const response = await this.webapi.search.update({businessCode: ret.value.get('businessCode'), keys: ret.value.get('keys')})\r\n            \r\n            if(response) {\r\n                this.metaAction.toast('success', '关键字编辑成功!')\r\n                this.injections.reduce('editRow', rowIndex, ret.value)\r\n            }\r\n        }\r\n    }\r\n    \r\n    handleEditCb = (injections, rowIndex) => {\r\n        return data => {\r\n            if(data && data.result) {\r\n                injections.reduce('clearEditKeys', rowIndex)\r\n            }\r\n        }\r\n    }\r\n    \r\n    getListRowsCount = () => {\r\n        return this.metaAction.gf('data.list').size\r\n    }\r\n    \r\n    pageChanged = (current, pageSize) => {\r\n        const filter = this.metaAction.gf(data.filter).toJS()\r\n        this.load({current, pageSize}, filter)\r\n    }\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaAction = new MetaAction(option),\r\n        o = new action({ ...option, metaAction }),\r\n        ret = { ...metaAction, ...o }\r\n\r\n    metaAction.config({ metaHandlers: ret })\r\n\r\n    return ret\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/bussinessSearch/action.js","import { Map, fromJS } from 'immutable'\r\nimport { reducer as MetaReducer } from 'mk-meta-engine'\r\nimport config from './config'\r\nimport { getInitState } from './data'\r\n\r\nclass reducer {\r\n    constructor(option) {\r\n        this.metaReducer = option.metaReducer\r\n        this.config = config.current\r\n    }\r\n\r\n    init = (state, option) => {\r\n        const initState = getInitState()\r\n        return this.metaReducer.init(state, initState)\r\n    }\r\n\r\n    load = (state, response) => {\r\n        state = this.metaReducer.sf(state, 'data.list', fromJS(response.list))\r\n        state = this.metaReducer.sf(state, 'data.allManualKeys', fromJS(response.list))\r\n//        state = this.metaReducer.sf(state, 'data.pagination', fromJS(response.pagination))\r\n//        state = this.metaReducer.sf(state, 'data.filter', fromJS(response.filter))\r\n        return state\r\n    }\r\n    \r\n    searchKeys = (state, searchValue, type, value) => {\r\n        state = this.metaReducer.sf(state, 'data.list', fromJS(searchValue))\r\n        state = this.metaReducer.sf(state, 'data.' + type, value)\r\n        return state\r\n    }\r\n    \r\n    editRow = (state, rowIndex, value) => {\r\n        let list = this.metaReducer.gf(state, 'data.list')\r\n        list = list.set(rowIndex, value)\r\n        state = this.metaReducer.sf(state, 'data.list', list)\r\n        return state\r\n    }\r\n    \r\n    clearEditKeys = (state, rowIndex) => {\r\n        let list = this.metaReducer.gf(state, 'data.list'),\r\n            editRow = list.get('rowIndex')\r\n        list = list.setIn([rowIndex, 'extKeys'], [])\r\n        state = this.metaReducer.sf(state, 'data.list', list)\r\n        return state\r\n    }\r\n}\r\n\r\nexport default function creator(option) {\r\n    const metaReducer = new MetaReducer(option),\r\n        o = new reducer({ ...option, metaReducer })\r\n\r\n    return { ...metaReducer, ...o }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./apps/portal/search/bussinessSearch/reducer.js"],"sourceRoot":""}